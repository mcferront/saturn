*******************************************************************************
●readme.doc種別　　　　　：DGT -> 3D Table ファイルコンバータ説明ファイル
●ファイル記号名称　　　　：DGTTO3DT.DOC
●対象ツール記号名称　　　：DGTTO3DT
●対象ツール名称　　　　　：DGT -> 3D Table ファイルコンバータ
●バージョン              ：1.00 Rel.08
●作成者　　　　　　　　　：
●作成日　　　　　　　　　：1995-05-23
●その他のメッセージ　　　：なし
*******************************************************************************

■変更履歴
　●Rel.08への変更点
　　RGB形式をサポートしました。

１．概要

　DGTファイル、RGBファイル中のテクスチャ、カラーデータを、ソフトウェアライブラリ
3DT形式のデータに変換する。

２．機能

(1) 必要なテクスチャファイルの選択は、SEGA3Dファイルを元に、自動的に行なう。
(2) パレット番号未定義ピクセル（0x0）には、まず空きパレットにRGB値0x0を定義
　した後、このパレット番号を割り付ける。
　　もし空きパレットがなかったら、エラーメッセージを出力し、暫定的に0番パレット
　を割り付ける。
(3) カラーモード0,2,3,4の場合は、カラーデータテーブルをポリゴン単位で出力する方式と、
　一つにまとめる方式を選択できる。
　ポリゴン単位で出力する場合は、カラーテーブル名の後ろに「_追番」を付加する。
　なお、カラーモード1の場合は、ポリゴン単位での出力のみである。


３．注意事項

(1) 本プログラムは、テクスチャ、カラーデータのみを出力する。
　したがって、モデル情報は別途s3dto3dtにより出力する必要がある。
(2) SEGA3Dファイルと、必要な全てのDGTファイルは、同一ディレクトリ内になければ
　ならない。
(3) カラーデータテーブルを一つにまとめる場合は、dgtファイル中のパレット番号を
　そのまま使用するので、各ポリゴン間で異なるカラーを割り付けないよう、注意が
　必要である。


４．制限事項

(1) テクスチャファイル名に、特殊文字は使用できない。（ただし、_は除く）
(2) 各パラメータの名前の長さ
　・１６文字まで。
(3) 各データの最大値は以下のとおり。
　・１ファイル当たりのピクセル数　　　　　　：５００００


５．入出力

(1) 入力データは、DGT形式またはRGB形式のデータと、SEGA3D形式のデータである。
　SEGA3D形式データのデフォルトの拡張子は.3dである。
(2) 出力データは、3DT形式のデータである。


６．実行形式

　dgtto3dt  <入出力ファイルディレクトリパス名>  <SEGA3Dファイル名>
・ただし、入出力ファイル名は、拡張子を除いたものとする。


７．オプションパラメータの指定

(1) オプションパラメータを記述したファイルを読み込むことにより、変更ができる。
(2) 本ファイルは、s3dto3dtと共通で使用する。
(3) オプションファイル名は、入出力ファイル名＋拡張子（.ctl）で、入出力データと
　同じディレクトリに置く。
(4) オプションファイルがないときは、default値が使われる。
(5) ; 以降はコメントとみなす。
(6) 指定できるパラメータは、以下のとおり。

	キーワード	パラメータ		      default値

	dgt_txc		出力ファイル名		|	no
	col_tbl		カラーテーブル名	|	colorData
	input		拡張子名		|	3d
	col_mode	カラーモード		|	1
(追)	spd_mode	透明無効モード		|	no
	palette_mode	カラーテーブル形式	|	sep

　dgt_txcは、出力ファイル名の指定を行なう。ファイル名を「"」で囲って記述する。
必須パラメータなので、指定がないときは、エラーメッセージを出力して終了する。

　col_tblは、カラーテーブル名の指定を行なう。

　inputは、入力ファイルの拡張子名を指定する。３文字以内の英数字とする。

　col_modeは、カラーモードの指定を行なう。
	モード0（ 16色カラーバンクモード）のとき		0
	モード1（ 16色カラールックアップテーブルモード）のとき	1
	モード2（ 64色カラーバンクモード）のとき		2
	モード3（128色カラーバンクモード）のとき		3
	モード4（256色カラーバンクモード）のとき		4
	モード5（32K色ＲＧＢモード）のとき		5
　を指定する。

　spd_modeは、キャラクタの透明ピクセルを無効にするか指定する。
	透明ピクセルを無効にするとき		on
	透明ピクセルを無効にしないとき		off

　palette_modeは、カラーテーブルの出力形式を指定する。
	カラーテーブルをポリゴン単位に出力するとき		sep
	カラーテーブルをまとめて出力するとき			comp

＜記述例＞

; option parameter define file ( .ctl )

dgt_txc		"sample.txc"
col_tbl		colorTable
input		s3d
col_mode	4
palette_mode	comp

８．エラーメッセージ一覧

dgtto3dt : Error : Output file name is not directed
・出力ファイル名が指定されていない。
・ファイル名を確認する。

dgtto3dt : Error : Input file not exist : Name = aaaa
・aaaaの名前で示されるSEGA3Dファイルが存在しない。
・ファイル名を確認する。

dgtto3dt : Error : Japanese character exist
・入力データに日本語が含まれている。
・適当な英数字に置き換える。

dgtto3dt : Error : Table Limit over : MBU_MAX
・マテリアル情報を格納する領域が不足した。
・プログラムの変更が必要。

dgtto3dt : Error : Table Limit over : TEX_MAX
・テクスチャ情報を格納する領域が不足した。
・プログラムの変更が必要。

dgtto3dt : Error : Palette No. doubly assigned : No = iiii
・iiiiで示されるパレットナンバに、２個以上の異なるカラーが割り付けられている。
・テクスチャデータを修正する。

dgtto3dt : Error : Input file not exist : Name = aaaa
・aaaaの名前で示されるテクスチャファイルが存在しない。
・ファイル名を確認する。

dgtto3dt : Error : Color palette over iiii : Name = aaaa
・aaaaの名前で示されるテクスチャファイル内で、iiiiで示される、使用できるパレット
数の上限を越えた。
・上限以内に収まるよう、データを修正する。

dgtto3dt : Error : Can not assign palette No. for undefined pixel. : Name = aaaa
・aaaaの名前で示されるテクスチャファイル内で、未定義パレットに割り付けるナンバが
不足した。
・テクスチャデータを修正する。

dgtto3dt : Error : Undefined palette no. used. : Name = aaaa
・aaaaの名前で示されるテクスチャファイル内で、定義されていないパレットナンバが使われた。
・テクスチャデータを修正する。

９．変更履歴
(Rel.7 -> Rel.8)
　・オプションパラメータの指定に透明無効のオプションを追加しました。

*******************************************************************************

　DGTTO3DT.EXE、S3DTO3DT.EXEを利用する際の手順について記述します。


１．処理フロー図

	SEGA3D data					 Graphic data
	 (.3d)						   (.dgt)
	   |						     |
	   +--------------------------------------------+    |
	   |						|    |
	   |			Control data		|    |
	   |			  (.ctl)		|    |
      +----------+		   |  |		      +----------+
      | s3dto3dt |	<----------+  +---------->    |	dgtto3dt |
      +----------+				      +----------+
	   |						   |
	   |						   |
	   |						   |
	3DT data				    3DT texture data
	 (.dat)				   (「.ctl」の「dgt_txc」で指定した名前)




２．実行手順（１６色パレットモードデータの場合）

　例えば、SEGA3Dデータが「sample.3d」、グラフィックデータが「tex_1.dgt」と
「tex_2.dgt」であったとします。


(1) コントロールデータファイルを作成します。名前はSEGA3Dデータと同期させます。
　この場合は「sample.ctl」となります。内容は以下のとおりです。
-----------------------------------------------------
; option parameter define file ( .ctl )
col_mode	1
shading		*,no
dgt_txc		"sample.txc"
-----------------------------------------------------
(注) 「col_mode」は、１６色パレットモードデータの場合は１。
     「shading」は、常にこのとおりにしておいてください。
     「dgt_txc」は、任意の名前でも差しつかえありませんが、後々名前の重複等が
　　起こらないよう、「.3d」名と同期させておいたほうが良いでしょう。拡張子に
　　ついても、以後便宜的に「.txc」とします。


(2) 「sample.3d」「tex_1.dgt」「tex_2.dgt」「sample.ctl」を同一ディレクトリに
　置きます。


(3) s3dto3dt、dgtto3dtを実行します。どちらを先に処理しても構いません。
　データを置いたディレクトリから起動する場合は、以下のとおりです。
-----------------------------------------------------
s3dto3dt . sample
dgtto3dt . sample
-----------------------------------------------------


(4) 入力データと同一ディレクトリに、以下の２個のファイルが出来ます。
　「.dat」はs3dto3dt、「.txc」はdgtto3dtの出力データです。
　これらは２個で一組なので、移動するときは同時に行なってください。
-----------------------------------------------------
sample.dat
sample.txc
-----------------------------------------------------
(注) 「sample.dat」中には「sample.txc」をincludeする指定がしてあります。
　　 アプリケーションでは「sample.dat」をincludeするだけで、両方のデータが
　 取り込まれます。


(5) アプリケーション中で「sample.dat」をinclude指定して、コンパイルを行なって
　下さい。



３．補足事項

・「.dat」「.txc」は、cのコンパイラを通す関係で、変数名に特殊文字は使えないので
（ただし_は除く）、あらかじめチェックして取り除いておいて下さい。

・「.ctl」内で、「dgt_txc」を必ず指定しておくのには、3DTファイルが参照する
テクスチャファイル名を指定すると同時に、s3dto3dt側でのテクスチャに関する情報
の出力を抑止する意味があります。

・「.ctl」内で、「shading　*,no」によりシェーディングなしを指定しておくのは、
ソフトウェアライブラリでは、パレット形式データでシェーディングを行なう場合、
シェーディングインデックステーブルを各色ごとに、あらかじめ用意しておく必要が
ありますが、本コンバータはこれらのデータを生成することはできないためです。

・「.ctl」には、例題中で示した以外のパラメータもあります。それらの詳細について
は、各プログラムの「.doc」ファイルを参照して下さい。

・カラーモードが1の場合は、アプリケーション側でのカラーテーブル関係の指定は必要
ありません。
　ただし、SPR_2DefineWorkで指定する最大ルックアップテーブル数が、テクスチャ数
を下回らないよう注意して下さい。

・カラーモードが0,2,3,4の場合は、アプリケーション中でのカラーテーブル名と、
「.txc」ファイル中のカラーテーブル名（デフォルトではcolorData）を合わせて下さい。
　その際、アプリケーションで確保するテーブルサイズが、使用テーブルサイズ以下
にならないよう、注意して下さい。
　なお、カラーモードが0,2,3,4の場合の処理手順は、上述のカラーモードが1の場合と
変わりありませんが、「.ctl」ファイルの内容を以下のとおりとして下さい。
-----------------------------------------------------
; option parameter define file ( .ctl )

col_mode	4
palette_mode	comp
shading		*,no
dgt_txc		"sample.txc"
-----------------------------------------------------
(注) 「col_mode」は、必要に応じて0,2,3,4の中から選んで下さい。
     「palette_mode」は、アプリケーションの作り方に合わせて「comp」「sep」の
　　いずれかを選んでください。
*******************************************************************************
