*******************************************************************************
●readme.doc種別　　　　　：SEGA3D -> 3D Table ファイルコンバータ説明ファイル
●ファイル記号名称　　　　：S3DTO3DT.DOC
●対象ツール記号名称　　　：S3DTO3DT
●対象ツール名称　　　　　：SEGA3D -> 3D Table ファイルコンバータ
●バージョン              ：1.00 Rel.09
●作成者　　　　　　　　　：
●作成日　　　　　　　　　：1995-06-15
●その他のメッセージ　　　：なし
*******************************************************************************

■変更履歴
　●Rel.08への変更点
    モデルが複数ある場合に変換できない不具合を改善しました。

　●Rel.09への変更点
  ・Shade 3 で出力する頂点、面、オブジェクトを持たないモデルに登録する空データ
を処理するように変更しました。
　・デフォルトの頂点数、面数、オブジェクト数、スリップ数の設定を以下のように
変更しました。
    #define VERT_MAX    5000 ---> 2500 /* 頂点数の上限 */
    #define FACE_MAX              1000 /* 面数の上限 */
    #define OBJ_MAX     100  --->  200 /* オブジェクト数の上限 */
    #define CLS_MAX     100  --->  200 /* クラスタ数の上限 */
    #define SLP_MAX     200  --->  800 /* スリップ中の面数の上限 */
    #define TEX_MAX                100 /* テクスチャ数の上限 */
    #define MBU_MAX                100 /* マテリアルバッファ数 */
  
１．概要

　SEGA3D形式のデータを、ソフトウェアライブラリ3DT形式のデータに変換する。


２．機能

(1) SEGA3Dデータ中の各パラメータの記述が省略された時、初期値が決められている
　ものについては、それを適用する。
(2) モデル中で、法線ベクトル値が指定されていないときは、計算する。
(3) オブジェクトがない場合は、最後に読み込まれたモデルが対象になる。
(4) マテリアルのgour_offset、gour_colorは無視される。
(5) 反転が指定された場合は、頂点座標の符号および法線ベクトルの符号を逆にする。
　このとき、テクスチャは裏返しになる。
(6) スケールは継承される。
(7) モデル名の固有化のため、各モデル名の後ろに「＿追番」を付加する。


３．制限事項

(1) シェーディングの種別は、面単位ではなく、オブジェクト単位にセットされる。
　この時、slipsの最後に記述されたマテリアルのシェーディング種別が使われる。
(2) カラーモードはRGB形式にのみ対応している。
(3) 回転順序はZYXに固定されている。
(4) テクスチャを指定する場合は、3DT形式のデータファイルを別途用意する必要が
　ある。
(5) テクスチャのW,Hはそれぞれ96に固定されている。
　それ以外のサイズのテクスチャを使用する場合は、出力ファイル中の当該箇所を
マニュアルで修正する必要がある。
(6) 各パラメータの名前の長さ
　・１６文字まで。
(7) 各データの最大値は以下のとおり。
　・１モデル当たりの頂点数　　　　　　：５０００
　・１モデル当たりの面数　　　　　　　：１０００
　・モデル数　　　　　　　　　　　　　：１００
　・１モデル当たりの子モデル数　　　　：１００
(8) 各パラメータ名は、アルファベットのみ可能である。（日本語は不可）。


４．入出力

(1) 入力データは、SEGA3D形式のデータである。デフォルトの拡張子は.3dである。
(2) 出力データは、3DT形式のデータである。デフォルトの拡張子は.datである。


５．実行形式

　s3dto3dt  <入出力ファイルディレクトリパス名>  <入出力ファイル名>

・ただし、入出力ファイル名は、拡張子を除いたものとする。


６．オプションパラメータの指定

(1) オプションパラメータを記述したファイルを読み込むことにより、変更ができる。
(2) オプションファイル名は、入出力ファイル名＋拡張子（.ctl）で、入出力データと
　同じディレクトリに置く。
(3) オプションファイルがないときは、default値が使われる。
(4) ; 以降はコメントとみなす。
(5) 指定できるパラメータは、以下のとおり。

	キーワード	パラメータ		      default値

	scale		スケール値		|	1
	normal		yes/no			|	no
	cluster		クラスタ名		|	no
	surface_ctr	yes/no			|	no
	shading		モデル名,種別		|	本文参照
	input		拡張子名		|	3d
	output		拡張子名		|	dat
	dgt_txc		テクスチャファイル名	|	no

　scaleは、全体スケール値の指定を行なう。正の実数又は整数で指定する。

　normalは、法線ベクトルの強制計算の指示を行なう。法線ベクトルは、デフォルト
ではデータ中に記述がないときのみ計算するが、これを記述の有無に係わらず、必ず
計算させることができる。
　yesのとき計算し、noのとき記述のあるものは計算しない。

　clusterは、全体の親クラスタを追加するとき、その名前を指定する。
　noのときは追加しない。

　surface_ctrは、面の代表頂点座標計算の指示を行なう。
　yesのとき計算し、noのとき計算しない。

　shadingは、モデル単位のシェーディング種別を指定する。シェーディング種別は、
デフォルトではslipsの最後に記述されたマテリアルのシェーディング種別が使われる
が、これを明示的に指定することができる。
　モデル名、カンマ、シェーディング種別（no/flat/gouraud）の順に記述する。
　１行１モデル指定なので、モデルが複数あるときは、複数行での指定となる。
　全てのモデルを一括して指定したい場合は、モデル名を「*」にする。

　inputは、入力ファイルの拡張子名を指定する。３文字以内の英数字とする。

　outputは、出力ファイルの拡張子名を指定する。３文字以内の英数字とする。

　dgt_txcは、テクスチャ情報をdgtto3dtによりdgtファイルから取り込む場合、その
出力ファイル名の指定を行なう。ファイル名を「"」で囲って記述する。
　テクスチャ情報をdgtto3dtにより取り込まない場合は、指定する必要はない。


＜記述例＞

; option parameter define file ( .ctl )

scale		0.1
normal		yes
cluster		RootCluster
surface_ctr	yes
shading		CUBE,gouraud
input		s3d
output		ddt
dgt_txc		"sample.txc"

７．エラーメッセージ一覧

s3dto3dt : Error : Invalid object description : aaaa
・aaaaの名前で示されるオブジェクトが再帰的に呼び出されている。
・呼出し関係を修正する。

s3dto3dt : Error : Table Limit over : MBU_MAX
・マテリアル情報を格納する領域が不足した。
・プログラムの変更が必要。

s3dto3dt : Error : Input file not exist : Name = aaaa
・aaaaの名前で示される入力ファイルが存在しない。
・ファイル名を確認する。

s3dto3dt : Error : Japanese character exist
・入力データに日本語が含まれている。
・適当な英数字に置き換える。

s3dto3dt : Error : Table Limit over : OBJ_MAX
・オブジェクト情報を格納する領域が不足した。
・プログラムの変更が必要。

s3dto3dt : Error : Table Limit over : slp_face
・スリップ情報を格納する領域が不足した。
・プログラムの変更が必要。

s3dto3dt : Error : Table Limit over : TEX_MAX
・テクスチャ情報を格納する領域が不足した。
・プログラムの変更が必要。

８．変更履歴
(Rel.7 -> Rel.8)
　・モデルが複数ある場合にクラスタテーブルを作成しないバグを修正しました。
　・実行時の処理メッセージを表示するようにしました。

*******************************************************************************

　DGTTO3DT.EXE、S3DTO3DT.EXEを利用する際の手順について記述します。


１．処理フロー図

	SEGA3D data					 Graphic data
	 (.3d)						   (.dgt)
	   |						     |
	   +--------------------------------------------+    |
	   |						|    |
	   |			Control data		|    |
	   |			  (.ctl)		|    |
      +----------+		   |  |		      +----------+
      | s3dto3dt |	<----------+  +---------->    |	dgtto3dt |
      +----------+				      +----------+
	   |						   |
	   |						   |
	   |						   |
	3DT data				    3DT texture data
	 (.dat)				   (「.ctl」の「dgt_txc」で指定した名前)




２．実行手順（１６色パレットモードデータの場合）

　例えば、SEGA3Dデータが「sample.3d」、グラフィックデータが「tex_1.dgt」と
「tex_2.dgt」であったとします。


(1) コントロールデータファイルを作成します。名前はSEGA3Dデータと同期させます。
　この場合は「sample.ctl」となります。内容は以下のとおりです。
-----------------------------------------------------
; option parameter define file ( .ctl )
col_mode	1
shading		*,no
dgt_txc		"sample.txc"
-----------------------------------------------------
(注) 「col_mode」は、１６色パレットモードデータの場合は１。
     「shading」は、常にこのとおりにしておいてください。
     「dgt_txc」は、任意の名前でも差しつかえありませんが、後々名前の重複等が
　　起こらないよう、「.3d」名と同期させておいたほうが良いでしょう。拡張子に
　　ついても、以後便宜的に「.txc」とします。


(2) 「sample.3d」「tex_1.dgt」「tex_2.dgt」「sample.ctl」を同一ディレクトリに
　置きます。


(3) s3dto3dt、dgtto3dtを実行します。どちらを先に処理しても構いません。
　データを置いたディレクトリから起動する場合は、以下のとおりです。
-----------------------------------------------------
s3dto3dt . sample
dgtto3dt . sample
-----------------------------------------------------


(4) 入力データと同一ディレクトリに、以下の２個のファイルが出来ます。
　「.dat」はs3dto3dt、「.txc」はdgtto3dtの出力データです。
　これらは２個で一組なので、移動するときは同時に行なってください。
-----------------------------------------------------
sample.dat
sample.txc
-----------------------------------------------------
(注) 「sample.dat」中には「sample.txc」をincludeする指定がしてあります。
　　 アプリケーションでは「sample.dat」をincludeするだけで、両方のデータが
　 取り込まれます。


(5) アプリケーション中で「sample.dat」をinclude指定して、コンパイルを行なって
　下さい。



３．補足事項

・「.dat」「.txc」は、cのコンパイラを通す関係で、変数名に特殊文字は使えないので
（ただし_は除く）、あらかじめチェックして取り除いておいて下さい。

・「.ctl」内で、「dgt_txc」を必ず指定しておくのには、3DTファイルが参照する
テクスチャファイル名を指定すると同時に、s3dto3dt側でのテクスチャに関する情報
の出力を抑止する意味があります。

・「.ctl」内で、「shading　*,no」によりシェーディングなしを指定しておくのは、
ソフトウェアライブラリでは、パレット形式データでシェーディングを行なう場合、
シェーディングインデックステーブルを各色ごとに、あらかじめ用意しておく必要が
ありますが、本コンバータはこれらのデータを生成することはできないためです。

・「.ctl」には、例題中で示した以外のパラメータもあります。それらの詳細について
は、各プログラムの「.doc」ファイルを参照して下さい。

・カラーモードが1の場合は、アプリケーション側でのカラーテーブル関係の指定は必要
ありません。
　ただし、SPR_2DefineWorkで指定する最大ルックアップテーブル数が、テクスチャ数
を下回らないよう注意して下さい。

・カラーモードが0,2,3,4の場合は、アプリケーション中でのカラーテーブル名と、
「.txc」ファイル中のカラーテーブル名（デフォルトではcolorData）を合わせて下さい。
　その際、アプリケーションで確保するテーブルサイズが、使用テーブルサイズ以下
にならないよう、注意して下さい。
　なお、カラーモードが0,2,3,4の場合の処理手順は、上述のカラーモードが1の場合と
変わりありませんが、「.ctl」ファイルの内容を以下のとおりとして下さい。
-----------------------------------------------------
; option parameter define file ( .ctl )

col_mode	4
palette_mode	comp
shading		*,no
dgt_txc		"sample.txc"
-----------------------------------------------------
(注) 「col_mode」は、必要に応じて0,2,3,4の中から選んで下さい。
     「palette_mode」は、アプリケーションの作り方に合わせて「comp」「sep」の
　　いずれかを選んでください。
*******************************************************************************
